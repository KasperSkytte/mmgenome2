<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to mmgenome2 â€¢ mmgenome2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Introduction to mmgenome2">
<meta property="og:description" content="mmgenome2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93913019-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93913019-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mmgenome2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/mmgenome2.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kasperskytte/mmgenome2">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="mmgenome2_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to mmgenome2</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kasperskytte/mmgenome2/blob/master/vignettes/mmgenome2.Rmd"><code>vignettes/mmgenome2.Rmd</code></a></small>
      <div class="hidden name"><code>mmgenome2.Rmd</code></div>

    </div>

    
    
<p>This is a brief guide explaining the basics of how to use <code>mmgenome2</code> for genome binning and extraction from metagenomes. It is meant to only demonstrate fundamental principles and operations. For more detailed documentation of all mmgenome2 functions, their arguments, as well as example code, please refer to the <a href="../reference/index.html">Functions</a> page. First, install <code>mmgenome2</code> as described on the frontpage, and then download the example data from <a href="https://doi.org/10.6084/m9.figshare.6115655">figshare</a> and unzip the contained files into a folder of choice. Preloaded data is also available with <code><a href="https://rdrr.io/r/utils/data.html">data("mmgenome2")</a></code>.</p>
<div id="loading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-data" class="anchor"></a>Loading data</h2>
<p><code>mmgenome2</code> requires at minimum two types of data; the assembly and at minimum one coverage profile. Any number of coverage profiles can be loaded at once. Other than the assembly and coverage profiles, optional data includes essential genes, taxonomy, small subunit taxonomic classification, and anything else that could be relevant. The only requirement is that the data is in a row-by-column format, so that the first column contains scaffold names matching those in the assembly, and then any number of columns containing relevant information for the binning process. Metagenome data often consists of numerous files that first have to be loaded into R. The various files are loaded with the <code>mmload</code> function, which checks, adjusts, and combines the data into a single data frame, here called <code>mm</code>, which will be used in all other <code>mmgenome2</code> functions:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://kasperskytte.github.io/mmgenome2">mmgenome2</a></span><span class="op">)</span>
<span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmload.html">mmload</a></span><span class="op">(</span>
    assembly <span class="op">=</span> <span class="st">"data/assembly.fa"</span>,
    coverage <span class="op">=</span> <span class="st">"data/"</span>,
    essential_genes <span class="op">=</span> <span class="st">"data/essential.csv"</span>,
    taxonomy <span class="op">=</span> <span class="st">"data/tax.csv"</span>,
    additional <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/phylopythias.csv"</span><span class="op">)</span>,
    verbose <span class="op">=</span> <span class="cn">TRUE</span>,
    kmer_pca <span class="op">=</span> <span class="cn">FALSE</span>,
    kmer_BH_tSNE <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span></code></pre></div>
<p>This loads all the files into a single data frame object called <code>mm</code>. By giving a folder path to <code>coverage</code>, <code>mmload</code> expects all files in the folder that end with <code>"_cov"</code> to be coverage profiles, and will automatically load them all and name them by filename. By default the scaffold lengths as well as the GC content of each scaffold are calculated. Notice that it is also possible to perform Principal Components Analysis and t-SNE on tetra-nucleotide frequencies by setting <code>kmer_pca = TRUE</code> and <code>kmer_BH_tSNE = TRUE</code>, which will then also be available in the output data frame <code>mm</code> to aid the binning process. Any additional data can be provided with <code>additional</code>.</p>
<p>By simply typing the name of the object in the console we get a brief overview of the data frame:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mm</span></code></pre></div>
<pre><code>## # A tibble: 97,285 x 18
##    scaffold length    gc cov_C13.11.14 cov_C13.11.25 cov_C13.12.03 cov_C14.01.09
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
##  1 1          8264  57.8       1.44             53.6         0             0.066
##  2 2          1027  57.0       0.625            24.2         0             0    
##  3 3          1665  55.9      13.5             434.          0.166         0.177
##  4 4          9056  35.9       0.01             23.4         0             0    
##  5 5          3343  64.0       3.20             16.4         0             0    
##  6 6         98207  39.1       0.00966          24.5         3.29          9.85 
##  7 7          6480  63.0       2.61             19.2         1.46         12.3  
##  8 8         15790  61.7       2.78             21.2         1.62         10.3  
##  9 9          1403  70.4      85.1             192.          0             0    
## 10 10         2018  70.2      50.3             101.          0             0    
## # â€¦ with 97,275 more rows, and 11 more variables: geneID &lt;chr&gt;, phylum &lt;chr&gt;,
## #   count &lt;chr&gt;, all.phylum.assignments &lt;chr&gt;, class &lt;chr&gt;,
## #   all.class.assignments &lt;chr&gt;, pps_phylum &lt;chr&gt;, pps_class &lt;chr&gt;,
## #   pps_order &lt;chr&gt;, pps_family &lt;chr&gt;, pps_genus &lt;chr&gt;</code></pre>
<p>The <code>mmstats</code> function can also calculate some basic statistics about the data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mmstats.html">mmstats</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span></code></pre></div>
<pre><code>##                   General stats
## Scaffolds             97 285   
## N50                    5 291   
## Length.total     331 908 376   
## Length.max         1 446 979   
## Length.mean            3 411.71
## Length.min             1 000   
## weighted_GC_mean          52.22
## cov_C13.11.14              2.62
## cov_C13.11.25             16.06
## cov_C13.12.03              2.91
## cov_C14.01.09             11.58
## Ess.genes.total        7 138   
## Ess.genes.unique         109</code></pre>
</div>
<div id="initial-scaffold-extraction" class="section level2">
<h2 class="hasAnchor">
<a href="#initial-scaffold-extraction" class="anchor"></a>Initial scaffold extraction</h2>
<p>In <code>mmgenome2</code> there are currently 4 different plotting functions; <code>mmplot</code>, <code>mmplot_pairs</code>, <code>mmplot_cov_profiles</code>, and <code>mmnetwork</code>. <code>mmplot</code> can for example be used to generate a differential coverage plot with any <em>two</em> coverage profiles from the <code>mm</code> data frame, for example <code>cov_C13.11.25</code> and <code>cov_C14.01.09</code>. It is often a good idea to apply a log10 scale to the axes, or to adjust the axis limits to get a symmetrical plot or to zoom in at selected regions. By default the axes are automatically scaled. In the following plot the scaffolds are colored by taxonomy, but we could also color by GC content or any other variable in <code>mm</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mmplot.html">mmplot</a></span><span class="op">(</span><span class="va">mm</span>,
       x <span class="op">=</span> <span class="st">"cov_C13.11.25"</span>,
       y <span class="op">=</span> <span class="st">"cov_C14.01.09"</span>,
       color_by <span class="op">=</span> <span class="st">"phylum"</span>,
       x_scale <span class="op">=</span> <span class="st">"log10"</span>,
       y_scale <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span></code></pre></div>
<p><img src="mmgenome2_files/figure-html/unnamed-chunk-6-1.png" width="864"></p>
<p>In both <code>mmplot</code> and <code>mmnetwork</code> there is incorporated a locator feature, which makes it possible to interactively click in the plot and capture the exact positions of the mouse clicks on the axes plotted. This is enabled by setting <code>locator = TRUE</code> and is used to extract scaffolds within a region of interest, reproducibly. The selection of points can then be highlighted as a polygon by the <code>selection</code> argument:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>cov_C13.11.25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.2</span>, <span class="fl">16.2</span>, <span class="fl">25.2</span>, <span class="fl">23.3</span>, <span class="fl">10.1</span><span class="op">)</span>,
                        cov_C14.01.09 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">47</span>, <span class="fl">77</span>, <span class="fl">52.8</span>, <span class="fl">29.5</span>, <span class="fl">22.1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/mmplot.html">mmplot</a></span><span class="op">(</span><span class="va">mm</span>,
       x <span class="op">=</span> <span class="st">"cov_C13.11.25"</span>,
       y <span class="op">=</span> <span class="st">"cov_C14.01.09"</span>,
       min_length <span class="op">=</span> <span class="fl">3000</span>,
       color_by <span class="op">=</span> <span class="st">"phylum"</span>,
       x_scale <span class="op">=</span> <span class="st">"log10"</span>,
       x_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span><span class="op">)</span>,
       y_scale <span class="op">=</span> <span class="st">"log10"</span>,
       y_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span><span class="op">)</span>,
       <span class="co">#locator = TRUE, #uncomment to use the locator and return a selection</span>
       selection <span class="op">=</span> <span class="va">selection</span><span class="op">)</span></code></pre></div>
<p><img src="mmgenome2_files/figure-html/unnamed-chunk-7-1.png" width="864"></p>
<p>To extract all scaffolds within the selection polygon (including those not shown in the plot if a <code>min_length</code> has been set) from <code>mm</code> use <code>mmextract</code> and provide the selection in the same way as with <code><a href="../reference/mmplot.html">mmplot(mm, ..., selection = selection)</a></code>, and then save in a new object <code>mm_subset1</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mm_subset1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmextract.html">mmextract</a></span><span class="op">(</span><span class="va">mm</span>, selection <span class="op">=</span> <span class="va">selection</span><span class="op">)</span></code></pre></div>
<pre><code>## 61 scaffolds (or 1.34% of the scaffolds in mm, weighted by length) remain after 97224 of 97285 scaffolds have been filtered.</code></pre>
<p>Then the extracted set of scaffolds can be plotted separately to get a closer look (no log10 scaled axes or <code>min_length</code> set this time):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mmplot.html">mmplot</a></span><span class="op">(</span><span class="va">mm_subset1</span>,
       x <span class="op">=</span> <span class="st">"cov_C13.11.25"</span>,
       y <span class="op">=</span> <span class="st">"cov_C14.01.09"</span>,
       color_by <span class="op">=</span> <span class="st">"phylum"</span><span class="op">)</span></code></pre></div>
<p><img src="mmgenome2_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>To look for any eventual contaminants or to have a look at the scaffolds at different coverage profiles we can use the <code>mmplot_pairs</code> function to plot more than two coverage profiles at the same time as well as any other variables. To see which variables that are available to plot, either type <code><a href="https://rdrr.io/r/utils/str.html">str(mm)</a></code> or simply just the name of the object in the console again (it is recommended to only plot continuous/numerical variables like coverage or GC content etc.). Note that this time no log10 scale is applied to the axes and the points are not scaled by scaffold size, but is set to a fixed size <code>3</code> instead:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span></code></pre></div>
<pre><code>## tibble[,18] [97,285 Ã— 18] (S3: tbl_df/tbl/data.frame)
##  $ scaffold              : chr [1:97285] "1" "2" "3" "4" ...
##  $ length                : int [1:97285] 8264 1027 1665 9056 3343 98207 6480 15790 1403 2018 ...
##  $ gc                    : num [1:97285] 57.8 57 55.9 35.9 64 ...
##  $ cov_C13.11.14         : num [1:97285] 1.443 0.625 13.536 0.01 3.205 ...
##  $ cov_C13.11.25         : num [1:97285] 53.6 24.1 434.1 23.4 16.4 ...
##  $ cov_C13.12.03         : num [1:97285] 0 0 0.166 0 0 ...
##  $ cov_C14.01.09         : num [1:97285] 0.066 0 0.177 0 0 ...
##  $ geneID                : chr [1:97285] NA NA NA NA ...
##  $ phylum                : chr [1:97285] NA NA NA NA ...
##  $ count                 : chr [1:97285] NA NA NA NA ...
##  $ all.phylum.assignments: chr [1:97285] NA NA NA NA ...
##  $ class                 : chr [1:97285] NA NA NA NA ...
##  $ all.class.assignments : chr [1:97285] NA NA NA NA ...
##  $ pps_phylum            : chr [1:97285] "Proteobacteria" NA "Proteobacteria" NA ...
##  $ pps_class             : chr [1:97285] "Gammaproteobacteria" NA "Betaproteobacteria" NA ...
##  $ pps_order             : chr [1:97285] NA NA "Hydrogenophilales" NA ...
##  $ pps_family            : chr [1:97285] NA NA "Hydrogenophilaceae" NA ...
##  $ pps_genus             : chr [1:97285] NA NA NA NA ...</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mmplot_pairs.html">mmplot_pairs</a></span><span class="op">(</span><span class="va">mm_subset1</span>,
             variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cov_C13.11.14"</span>,
                           <span class="st">"cov_C13.11.25"</span>,
                           <span class="st">"cov_C13.12.03"</span>,
                           <span class="st">"cov_C14.01.09"</span>,
                           <span class="st">"gc"</span><span class="op">)</span>,
             color_by <span class="op">=</span> <span class="st">"phylum"</span>,
             x_scale <span class="op">=</span> <span class="st">"log10"</span>,
             y_scale <span class="op">=</span> <span class="st">"log10"</span>,
             alpha <span class="op">=</span> <span class="fl">0.4</span>,
             size_scale <span class="op">=</span> <span class="fl">0.7</span>,
             textsize <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> </code></pre></div>
<p><img src="mmgenome2_files/figure-html/unnamed-chunk-10-1.png" width="768"></p>
<p>#Second extraction from the initial extraction Using different coverage profiles than in the initial extraction, for example <code>cov_C13.11.14</code> and <code>cov_C13.12.03</code>, it may be easier to spot and remove contaminants. Note that we now override the previous <code>selection</code> with different coordinates on different axes:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>cov_C13.12.03 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.48</span>, <span class="fl">4.95</span>, <span class="fl">6.97</span>, <span class="fl">13.6</span>, <span class="fl">15.7</span>, <span class="fl">9.68</span>, <span class="fl">4.48</span><span class="op">)</span>,
                        cov_C13.11.14 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.407</span>, <span class="fl">1.72</span>, <span class="fl">2.92</span>, <span class="fl">1.45</span>, <span class="fl">0.264</span>, <span class="fl">0.17</span>, <span class="fl">0.163</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/mmplot.html">mmplot</a></span><span class="op">(</span><span class="va">mm_subset1</span>,
       x <span class="op">=</span> <span class="st">"cov_C13.12.03"</span>,
       y <span class="op">=</span> <span class="st">"cov_C13.11.14"</span>,
       x_scale <span class="op">=</span> <span class="st">"log10"</span>,
       y_scale <span class="op">=</span> <span class="st">"log10"</span>,
       color_by <span class="op">=</span> <span class="st">"phylum"</span>, 
       selection <span class="op">=</span> <span class="va">selection</span><span class="op">)</span></code></pre></div>
<p><img src="mmgenome2_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Now we can extract the scaffolds into a second subset of scaffolds, letâ€™s save it as <code>mm_subset2</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mm_subset2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmextract.html">mmextract</a></span><span class="op">(</span><span class="va">mm_subset1</span>, selection <span class="op">=</span> <span class="va">selection</span><span class="op">)</span></code></pre></div>
<pre><code>## 45 scaffolds (or 98.46% of the scaffolds in mm, weighted by length) remain after 16 of 61 scaffolds have been filtered.</code></pre>
</div>
<div id="paired-end-connections" class="section level2">
<h2 class="hasAnchor">
<a href="#paired-end-connections" class="anchor"></a>Paired end connections</h2>
<p>Until now we have only extracted scaffolds based on coverage profiles. Using paired-end reads we can look for scaffolds that may have had a different coverage (fx due to repeats) than the current set of scaffolds, even though they may be related. This is visualised by the <code>mmnetwork</code> function, which creates a network plot (generated by <a href="http://igraph.org/r/">igraph</a>) of connected scaffolds. First we need to load the paired-end data:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">paired_ends</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/paired_ends.csv"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mmnetwork.html">mmnetwork</a></span><span class="op">(</span><span class="va">mm_subset2</span>, 
          network <span class="op">=</span> <span class="va">paired_ends</span>,
          color_by <span class="op">=</span> <span class="st">"phylum"</span>,
          min_connections <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="mmgenome2_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>The thickness of the lines between the scaffolds is then scaled by the number of connections between the scaffolds according to the paired-end reads. Only the scaffolds in <code>mm_subset2</code> are plotted, and these may have further connections to other scaffolds that are not in the current subset, for example due to repeats and low-abundant microdiversity. To find additional connected scaffolds in the full dataset <code>mm</code> we use the <code>mmexpand_network</code> function. Here we set the minimum connections to 1 and only direct connections are extracted (meaning no connections of connections):</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mm_subset2_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmexpand_network.html">mmexpand_network</a></span><span class="op">(</span>mm <span class="op">=</span> <span class="va">mm</span>, 
                                   scaffolds <span class="op">=</span> <span class="va">mm_subset2</span>,
                                   network <span class="op">=</span> <span class="va">paired_ends</span>,
                                   min_connections <span class="op">=</span> <span class="fl">1</span>,
                                   include_connections <span class="op">=</span> <span class="st">"direct"</span><span class="op">)</span></code></pre></div>
<pre><code>## The provided 45 scaffolds had 36 additional direct connections to other scaffolds in mm.
## Total: 81 scaffolds (or 2.24% of the scaffolds in mm, weighted by length).</code></pre>
<p>As the message states, there is 36 additional connections to the 45 scaffolds in <code>mm_subset2</code>, which are now included in the new object <code>mm_subset2_exp</code>. This has also introduced 3 groups of scaffolds which seem unrelated to the genome bin, as seen below. To further refine the genome bin we can now plot the expanded subset again to identify these contaminants and again use the locator to remove them:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.521</span>, <span class="op">-</span><span class="fl">0.43</span>, <span class="fl">3.028</span>, <span class="fl">7.376</span>, <span class="fl">10.709</span>, <span class="fl">13.462</span>, <span class="fl">14.622</span>, <span class="fl">14.216</span>, <span class="fl">10.94</span>, <span class="fl">3.238</span><span class="op">)</span>,
                        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.443</span>, <span class="fl">10.425</span>, <span class="fl">14.678</span>, <span class="fl">13.155</span>, <span class="fl">9.664</span>, <span class="fl">6.934</span>, <span class="fl">6.649</span>, <span class="fl">4.586</span>, <span class="fl">0.936</span>, <span class="fl">0.945</span><span class="op">)</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmnetwork.html">mmnetwork</a></span><span class="op">(</span><span class="va">mm_subset2_exp</span>,
               network <span class="op">=</span> <span class="va">paired_ends</span>,
               color_by <span class="op">=</span> <span class="st">"phylum"</span>,
               <span class="co">#locator = TRUE, #uncomment to mark a selection to highlight and extract</span>
               min_connections <span class="op">=</span> <span class="fl">1</span>,
               selection <span class="op">=</span> <span class="va">selection</span><span class="op">)</span>
<span class="va">p</span></code></pre></div>
<p><img src="mmgenome2_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mm_subset3</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">data_in_selection</span> <span class="co">#there is no separate mmextract() function for network plots</span></code></pre></div>
<p>Beware that with <code>mmnetwork</code> there is no separate extract function like <code>mmextract</code> is for <code>mmplot</code>. This is because the axes in a network plot are synthetic and are not directly contained within the data like for example coverage profiles are. Therefore, to extract all scaffolds in the selected subspace in the network plot it is instead available in the returned plot object. If for example the network plot is assigned to the object <code>p</code>, then the subset data in the selection is available with <code>p$data_in_selection</code>. The above selection then removed 20 scaffolds and there is now 61 scaffolds remaining:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mm_subset3</span></code></pre></div>
<pre><code>## # A tibble: 61 x 18
##    scaffold length    gc cov_C13.11.14 cov_C13.11.25 cov_C13.12.03 cov_C14.01.09
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
##  1 180       22093  74.0         0.298          12.0          7.34          37.9
##  2 181        2970  68.0         0.34           13.9          7.37          38.6
##  3 227      190826  65.4         0.348          13.0          6.91          38.5
##  4 253      296715  70.2         1.06           15.2          7.00          41.1
##  5 315      218862  71.7         0.366          12.6          7.17          38.8
##  6 343       27203  57.6         0.235          10.7          5.07          32.0
##  7 386      164942  68.2         0.359          12.3          6.73          37.2
##  8 396        7448  72.6         0.329          13.0          7.59          41.0
##  9 423      100199  68.7         1.40           15.3          6.71          40.0
## 10 431      446220  72.4         0.409          12.6          6.80          37.9
## # â€¦ with 51 more rows, and 11 more variables: geneID &lt;chr&gt;, phylum &lt;chr&gt;,
## #   count &lt;chr&gt;, all.phylum.assignments &lt;chr&gt;, class &lt;chr&gt;,
## #   all.class.assignments &lt;chr&gt;, pps_phylum &lt;chr&gt;, pps_class &lt;chr&gt;,
## #   pps_order &lt;chr&gt;, pps_family &lt;chr&gt;, pps_genus &lt;chr&gt;</code></pre>
<p>#Final trimming and evaluation Using again the coverage profiles we can identify correct repeats and remove additional contamination with the locator. Here the sizes of the scaffolds are set to a fixed value by <code>fixed_size = 5</code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">selection</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>cov_C14.01.09  <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">15.5</span>, <span class="fl">69.1</span>, <span class="fl">103</span>, <span class="fl">106</span>, <span class="fl">54.9</span><span class="op">)</span>,
                       cov_C13.11.25  <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.28</span>, <span class="fl">17.2</span>, <span class="fl">163</span>, <span class="fl">165</span>, <span class="fl">21.4</span>, <span class="fl">7.76</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/mmplot.html">mmplot</a></span><span class="op">(</span><span class="va">mm_subset3</span>,
       x <span class="op">=</span> <span class="st">"cov_C14.01.09"</span>, 
       y <span class="op">=</span> <span class="st">"cov_C13.11.25"</span>,
       x_scale <span class="op">=</span> <span class="st">"log10"</span>,
       y_scale <span class="op">=</span> <span class="st">"log10"</span>,
       x_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">200</span><span class="op">)</span>,
       y_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">200</span><span class="op">)</span>,
       <span class="co">#locator = TRUE,</span>
       color_by <span class="op">=</span> <span class="st">"phylum"</span>,
       fixed_size <span class="op">=</span> <span class="fl">5</span>,
       selection <span class="op">=</span> <span class="va">selection</span><span class="op">)</span></code></pre></div>
<p><img src="mmgenome2_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>And then the final bin is extracted and saved into a final object <code>bin1</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bin1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmextract.html">mmextract</a></span><span class="op">(</span><span class="va">mm_subset3</span>,
                  selection <span class="op">=</span> <span class="va">selection</span><span class="op">)</span></code></pre></div>
<pre><code>## 44 scaffolds (or 96.61% of the scaffolds in mm, weighted by length) remain after 17 of 61 scaffolds have been filtered.</code></pre>
<p>To evaluate genome completeness and to get an overview of the basic information about <code>bin1</code> it may be useful to have a look at the output of <code>mmstats</code> of the bin:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mmstats.html">mmstats</a></span><span class="op">(</span><span class="va">bin1</span><span class="op">)</span></code></pre></div>
<pre><code>##                  General stats
## Scaffolds                44   
## N50                 199 460   
## Length.total      4 386 010   
## Length.max          454 223   
## Length.mean          99 682.05
## Length.min            1 241   
## weighted_GC_mean         71.11
## cov_C13.11.14             0.56
## cov_C13.11.25            13.36
## cov_C13.12.03             6.94
## cov_C14.01.09            38.8 
## Ess.genes.total         108   
## Ess.genes.unique        105</code></pre>
<p>We can then highlight the final genome bin in a differential coverage plot of the complete metagenome by setting <code>highlight_scaffolds = bin1</code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mmplot.html">mmplot</a></span><span class="op">(</span><span class="va">mm</span>,
       x <span class="op">=</span> <span class="st">"cov_C14.01.09"</span>,
       y <span class="op">=</span> <span class="st">"cov_C13.11.25"</span>,
       x_scale <span class="op">=</span> <span class="st">"log10"</span>,
       y_scale <span class="op">=</span> <span class="st">"log10"</span>,
       highlight_scaffolds <span class="op">=</span> <span class="va">bin1</span><span class="op">)</span></code></pre></div>
<p><img src="mmgenome2_files/figure-html/unnamed-chunk-21-1.png" width="864"></p>
<p>#Export the scaffolds in the genome bin from the assembly Now that we are happy with the genome bin we can export the sequences of the scaffolds from the assembly to a separate FASTA file using <code>mmexport</code> and repeat the analysis to make another bin:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mmexport.html">mmexport</a></span><span class="op">(</span><span class="va">bin1</span>,
         assembly <span class="op">=</span> <span class="va">assembly</span>,
         file <span class="op">=</span> <span class="st">"bins/bin1.fa"</span><span class="op">)</span></code></pre></div>
<p>After each genome extraction it is often a good idea to clear the current working environment to ensure a clean workflow with no accidental mixing of objects. To make sure that the same scaffolds are not used for different bins, the <code>mmscanbins</code> function can be used to scan a bin folder for FASTA files and return a list with all scaffold names found in those files. This is useful to highlight already extracted scaffolds in plots or to simply identify them and remove them from other bins.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mads Albertsen, Kasper Skytte Andersen, Rasmus Hansen Kirkegaard, SÃ¸ren Michael Karst.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '71d76a1c4adc57e7823b1c5a1e39065e',
    indexName: 'mmgenome2',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
